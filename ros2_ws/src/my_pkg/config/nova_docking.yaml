docking_server:
  ros__parameters:
    controller_frequency: 50.0
    initial_perception_timeout: 5.0
    wait_charge_timeout: 5.0
    dock_approach_timeout: 30.0
    undock_linear_tolerance: 0.05
    undock_angular_tolerance: 0.1
    max_retries: 3
    base_frame: "base_link"
    fixed_frame: "odom"
    dock_backwards: false
    dock_prestaging_tolerance: 0.5
    
    # 플러그인 설정
    dock_plugins: ['nova_carter_dock']
    
    nova_carter_dock:
      plugin: 'opennav_docking::SimpleChargingDock'
      docking_threshold: 0.05
      staging_x_offset: -0.7
      use_external_detection_pose: true
      use_battery_status: false
      use_stall_detection: false
      external_detection_timeout: 1.0
      
      # 카메라 물리적 오프셋 (base_link 기준)
      external_detection_translation_x: -0.18
      external_detection_translation_y: 0.0
      
      # ============================================
      # [핵심] 카메라 → 로봇 좌표계 변환
      # ============================================
      # Camera Frame:  X(좌우), Y(상하), Z(전방)
      # Robot Frame:   X(전방), Y(좌우), Z(상하)
      # 
      # Roll=-90°:  Camera Y → Robot Z
      # Pitch=-90°: Camera Z → Robot X
      external_detection_rotation_roll: -1.57   # -90°
      external_detection_rotation_pitch: -1.57  # -90°
      external_detection_rotation_yaw: 0.0
      
      filter_coef: 0.1
    
    # 독(Dock) 인스턴스 설정
    docks: ['home_dock']
    
    home_dock:
      type: 'nova_carter_dock'
      frame: odom
      # pose: [x, y, theta]
      # 실제 충전소 위치 (Isaac Sim 스크린샷 기준)
      pose: [23.06, 13.58, 1.57]  # yaw=1.57 (90°, 북쪽 향함)
    
    controller:
      k_phi: 3.0
      k_delta: 2.0
      v_linear_min: 0.15
      v_linear_max: 0.15